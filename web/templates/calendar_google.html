<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{if .IsCoach}}–ö–∞–ª–µ–Ω–¥–∞—Ä—å —Ç—Ä–µ–Ω–µ—Ä–∞{{else}}–ú–æ–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å{{end}} - Spectrum Club</title>
    <style>
        /* Google Calendar-inspired styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
            background: #fff;
            color: #202124;
            font-size: 14px;
            line-height: 1.4286;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 16px;
        }

        /* Header - Google Calendar style */
        .calendar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            border-bottom: 1px solid #dadce0;
            background: #fff;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .logo {
            font-weight: 500;
            font-size: 22px;
            color: #1a73e8;
            text-decoration: none;
        }

        .logo span {
            color: #ea4335;
        }

        .current-date {
            font-size: 22px;
            font-weight: 400;
            color: #3c4043;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Google-style buttons */
        .g-btn {
            padding: 8px 24px;
            border-radius: 4px;
            border: 1px solid #dadce0;
            background: #fff;
            color: #3c4043;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            text-decoration: none;
        }

        .g-btn:hover {
            background: #f8f9fa;
            border-color: #d2e3fc;
        }

        .g-btn-primary {
            background: #1a73e8;
            color: white;
            border-color: #1a73e8;
        }

        .g-btn-primary:hover {
            background: #0d62d9;
            border-color: #0d62d9;
        }

        /* Calendar navigation */
        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 16px 0;
            padding: 0 24px;
        }

        .nav-date {
            font-size: 18px;
            font-weight: 400;
            color: #3c4043;
            margin: 0 12px;
        }

        /* View selector */
        .view-selector {
            display: inline-flex;
            border: 1px solid #dadce0;
            border-radius: 4px;
            overflow: hidden;
            margin-left: auto;
        }

        .view-btn {
            padding: 8px 16px;
            background: #fff;
            border: none;
            color: #5f6368;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .view-btn:hover {
            background: #f8f9fa;
        }

        .view-btn.active {
            background: #1a73e8;
            color: white;
        }

        /* Main calendar grid */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            border: 1px solid #dadce0;
            border-radius: 8px;
            overflow: hidden;
            margin: 16px 24px;
            background: #fff;
        }

        /* Day headers */
        .day-header {
            padding: 12px;
            text-align: center;
            font-weight: 500;
            color: #5f6368;
            border-bottom: 1px solid #dadce0;
            background: #f8f9fa;
        }

        .day-header.today {
            color: #1a73e8;
        }

        .day-header .date-num {
            font-size: 24px;
            font-weight: 400;
            color: #202124;
            margin-bottom: 4px;
        }

        .day-header.today .date-num {
            color: #1a73e8;
        }

        .day-header .day-name {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.8px;
        }

        /* Calendar cells */
        .calendar-cell {
            min-height: 120px;
            padding: 8px;
            border-right: 1px solid #dadce0;
            border-bottom: 1px solid #dadce0;
            background: #fff;
            position: relative;
        }

        .calendar-cell:nth-child(7n) {
            border-right: none;
        }

        .calendar-cell:last-child {
            border-right: none;
        }

        .calendar-cell.today {
            background: #f0f6ff;
        }

        .calendar-cell.other-month {
            background: #f8f9fa;
            color: #9aa0a6;
        }

        /* Events in calendar */
        .calendar-event {
            position: absolute;
            left: 2px;
            right: 2px;
            padding: 6px 8px;
            border-radius: 4px;
            font-size: 12px;
            line-height: 1.3;
            overflow: hidden;
            cursor: pointer;
            transition: opacity 0.2s;
            z-index: 1;
        }

        .calendar-event:hover {
            opacity: 0.9;
        }

        .event-title {
            font-weight: 500;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .event-time {
            font-size: 11px;
            opacity: 0.9;
        }

        .event-coach {
            font-size: 11px;
            opacity: 0.8;
            margin-top: 2px;
        }

        /* Event colors based on groups */
        .event-color-1 { background: #e8f0fe; border-left: 3px solid #1a73e8; color: #1967d2; }
        .event-color-2 { background: #fce8e6; border-left: 3px solid #d93025; color: #c5221f; }
        .event-color-3 { background: #e6f4ea; border-left: 3px solid #137333; color: #0d652d; }
        .event-color-4 { background: #fef7e0; border-left: 3px solid #f29900; color: #b06000; }
        .event-color-5 { background: #f3e8fd; border-left: 3px solid #9334e6; color: #7a27bf; }

        /* Week view layout */
        .week-container {
            display: flex;
            margin: 16px 24px;
        }

        .time-column {
            width: 80px;
            border-right: 1px solid #dadce0;
        }

        .time-slot {
            height: 60px;
            padding: 4px;
            text-align: right;
            color: #5f6368;
            font-size: 12px;
            border-bottom: 1px solid #dadce0;
        }

        .week-grid {
            flex: 1;
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }

        /* Day view layout */
        .day-container {
            display: flex;
            margin: 16px 24px;
        }

        .day-grid {
            flex: 1;
            position: relative;
            border: 1px solid #dadce0;
        }

        /* Schedule list view */
        .schedule-day {
            margin-bottom: 32px;
        }

        .day-title {
            color: #3c4043;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid #dadce0;
        }

        .schedule-event {
            margin-bottom: 8px;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .schedule-event:hover {
            transform: translateY(-2px);
        }

        .event-time-display {
            min-width: 100px;
            color: #5f6368;
            font-size: 14px;
        }

        .event-details {
            flex: 1;
        }

        .event-main-title {
            font-weight: 500;
            color: #202124;
            margin-bottom: 4px;
        }

        .event-meta {
            font-size: 13px;
            color: #5f6368;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 10000;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            animation: modalSlideIn 0.3s ease-out;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid #dadce0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
            border-radius: 12px 12px 0 0;
        }
        
        .modal-header h3 {
            margin: 0;
            color: #202124;
            font-size: 20px;
            font-weight: 500;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #5f6368;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .modal-close:hover {
            background: #f1f3f4;
        }
        
        .modal-body {
            padding: 24px;
        }
        
        .training-details {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .detail-row {
            display: flex;
            align-items: flex-start;
            margin-bottom: 8px;
        }
        
        .detail-label {
            min-width: 120px;
            color: #5f6368;
            font-size: 14px;
        }
        
        .detail-value {
            flex: 1;
            color: #202124;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .attendance-list {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .attendance-item {
            padding: 8px 12px;
            border-bottom: 1px solid #e8eaed;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .attendance-item:last-child {
            border-bottom: none;
        }
        
        .attendance-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #1a73e8;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
        }
        
        .attendance-name {
            font-weight: 500;
            color: #202124;
        }
        
        .attendance-time {
            font-size: 12px;
            color: #5f6368;
            margin-top: 2px;
        }
        
        .modal-actions {
            display: flex;
            gap: 12px;
            padding-top: 16px;
            border-top: 1px solid #e8eaed;
        }
        
        .modal-btn {
            flex: 1;
            padding: 10px 16px;
            border-radius: 6px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .modal-btn-primary {
            background: #1a73e8;
            color: white;
        }
        
        .modal-btn-primary:hover {
            background: #0d62d9;
        }
        
        .modal-btn-danger {
            background: #ea4335;
            color: white;
        }
        
        .modal-btn-danger:hover {
            background: #d93025;
        }
        
        .modal-btn-secondary {
            background: #f1f3f4;
            color: #202124;
        }
        
        .modal-btn-secondary:hover {
            background: #e8eaed;
        }
        .g-btn-danger-outline {
            background: #fce8e6 !important;
            color: #c5221f !important;
            border-color: #fce8e6 !important;
        }

        .g-btn-danger-outline:hover {
            background: #f5c6cb !important;
            border-color: #f5c6cb !important;
        }

        /* –ù–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –Ω–∞ –º–æ–±–∏–ª–∫–∞—Ö */
        .events-container {
            position: relative;
            height: 100%;
            margin-top: 30px;
        }

        .mobile-event {
            margin-bottom: 4px;
            border-radius: 4px;
            overflow: hidden;
        }

        .mobile-event .event-title {
            white-space: normal;
            line-height: 1.2;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .calendar-header {
                flex-direction: column;
                gap: 16px;
                text-align: center;
            }
            
            .header-left, .header-right {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .calendar-grid {
                margin: 16px 8px;
                overflow-x: auto;
                min-width: 700px;
            }
            
            .week-container, .day-container {
                margin: 16px 8px;
                overflow-x: auto;
            }
            
            .week-grid {
                min-width: 700px;
            }
            
            .day-grid {
                min-width: 300px;
            }
        }

        @media (max-width: 768px) {
            /* –£–ª—É—á—à–∞–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –≤ —è—á–µ–π–∫–∞—Ö –¥–ª—è –º–æ–±–∏–ª–æ–∫ */
            .calendar-grid {
                grid-template-columns: repeat(7, minmax(100px, 1fr));
                overflow-x: auto;
                min-width: 700px;
                -webkit-overflow-scrolling: touch;
            }
            
            .calendar-cell {
                min-height: 100px !important; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
                min-width: 100px;
                padding: 4px;
                overflow: visible !important;
            }
            
            /* –£–±–∏—Ä–∞–µ–º –∞–±—Å–æ–ª—é—Ç–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —Å–æ–±—ã—Ç–∏–π –Ω–∞ –º–æ–±–∏–ª–∫–∞—Ö */
            .calendar-event {
                position: relative !important;
                top: auto !important;
                left: auto !important;
                right: auto !important;
                height: auto !important;
                margin-bottom: 3px;
                width: 100%;
                padding: 4px 6px;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            
            /* –£–º–µ–Ω—å—à–∞–µ–º –æ—Ç—Å—Ç—É–ø—ã –¥–ª—è –¥–∞—Ç—ã */
            .calendar-cell > div:first-child {
                position: absolute;
                top: 2px;
                left: 4px;
                font-size: 11px;
                background: rgba(255,255,255,0.8);
                padding: 1px 3px;
                border-radius: 2px;
            }
            
            .events-container {
                margin-top: 16px;
                max-height: 80px;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .mobile-event {
                font-size: 10px;
                line-height: 1.1;
                padding: 3px 4px;
                margin-bottom: 2px;
            }
            
            .event-title {
                font-size: 10px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            
            .event-time, .event-coach {
                font-size: 8px;
                display: none; /* –°–∫—Ä—ã–≤–∞–µ–º –Ω–∞ –º–æ–±–∏–ª–∫–∞—Ö –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞ */
            }
            
            /* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –≤—Ä–µ–º—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –∏–ª–∏ –∫–ª–∏–∫–µ */
            .calendar-event:hover .event-time,
            .calendar-event:hover .event-coach {
                display: block;
            }
            
            /* –ù–µ–¥–µ–ª—å–Ω—ã–π –≤–∏–¥ */
            .week-container {
                overflow-x: auto;
            }
            
            .week-grid {
                grid-template-columns: repeat(7, minmax(120px, 1fr));
                min-width: 840px;
            }
            
            .time-column {
                min-width: 60px;
            }
            
            .time-slot {
                height: 50px;
                font-size: 11px;
            }
            
            /* –î–Ω–µ–≤–Ω–æ–π –≤–∏–¥ */
            .day-container {
                overflow-x: auto;
            }
            
            .day-grid {
                min-width: 500px;
            }
            
            /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
            .calendar-nav {
                flex-wrap: wrap;
                justify-content: center;
                gap: 4px;
                padding: 0 8px;
            }
            
            .nav-date {
                order: 1;
                width: 100%;
                text-align: center;
                margin: 8px 0;
                font-size: 14px;
            }
            
            /* –ö–Ω–æ–ø–∫–∏ - –í–ê–ñ–ù–û: –∏—Å–ø—Ä–∞–≤–ª—è–µ–º –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ */
            .header-right {
                display: flex;
                align-items: center; /* –î–æ–±–∞–≤–ª—è–µ–º –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ø–æ —Ü–µ–Ω—Ç—Ä—É */
                justify-content: center;
                flex-wrap: wrap;
                gap: 8px; /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –æ—Ç—Å—Ç—É–ø –º–µ–∂–¥—É —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ */
                margin-top: 10px;
            }
            
            .g-btn {
                padding: 8px 16px; /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º padding –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—Å–∞–Ω–∏—è */
                font-size: 13px;
                height: 36px; /* –§–∏–∫—Å–∏—Ä—É–µ–º –≤—ã—Å–æ—Ç—É */
                box-sizing: border-box;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .view-btn {
                padding: 8px 16px;
                font-size: 13px;
                height: 36px; /* –¢–∞–∫–∞—è –∂–µ –≤—ã—Å–æ—Ç–∞ –∫–∞–∫ —É g-btn */
                box-sizing: border-box;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            /* –°–µ–ª–µ–∫—Ç–æ—Ä –≤–∏–¥–∞ - –¥–µ–ª–∞–µ–º –µ–≥–æ –Ω–∞ –æ–¥–Ω–æ–º —É—Ä–æ–≤–Ω–µ —Å –∫–Ω–æ–ø–∫–æ–π */
            .view-selector {
                margin-left: 0;
                margin-top: 0; /* –£–±–∏—Ä–∞–µ–º –≤–µ—Ä—Ö–Ω–∏–π –æ—Ç—Å—Ç—É–ø */
                display: inline-flex;
                align-items: center;
                height: 36px; /* –§–∏–∫—Å–∏—Ä—É–µ–º –≤—ã—Å–æ—Ç—É */
                border: 1px solid #dadce0;
                border-radius: 4px;
                overflow: hidden;
            }
            
            /* –ö–Ω–æ–ø–∫–∞ "–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ" - –¥–µ–ª–∞–µ–º –µ–µ –Ω–∞ –æ–¥–Ω–æ–º —É—Ä–æ–≤–Ω–µ */
            .header-right > .g-btn:last-child {
                margin: 0; /* –£–±–∏—Ä–∞–µ–º –≤—Å–µ –æ—Ç—Å—Ç—É–ø—ã */
                height: 36px; /* –¢–∞–∫–∞—è –∂–µ –≤—ã—Å–æ—Ç–∞ */
                min-width: 100px; /* –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã */
            }
            
            /* –£–±–∏—Ä–∞–µ–º –Ω–µ—Ä–∞–±–æ—Ç–∞—é—â–∏–µ –∫–Ω–æ–ø–∫–∏ –Ω–∞ –º–æ–±–∏–ª–∫–∞—Ö */
            .header-right .g-btn[href*="today"],
            .header-right .g-btn[href*="my-schedule"] {
                display: none;
            }
            
            /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
            .modal-content {
                width: 95%;
                max-width: 95%;
                margin: 10px;
            }
        }

        @media (max-width: 480px) {
            .calendar-header {
                padding: 12px 16px;
            }
            
            .logo {
                font-size: 18px;
            }
            
            .current-date {
                font-size: 16px;
            }
            
            .calendar-cell {
                min-height: 90px !important;
                min-width: 85px;
            }
            
            .calendar-grid {
                min-width: 595px;
            }
            
            .day-header {
                padding: 6px 2px;
            }
            
            .day-header .date-num {
                font-size: 16px;
            }
            
            .day-header .day-name {
                font-size: 9px;
            }
            
            .events-container {
                margin-top: 14px;
                max-height: 70px;
            }
            
            .calendar-event {
                padding: 3px;
                margin-bottom: 2px;
            }
            
            .event-title {
                font-size: 9px;
            }
            
            /* –£–ª—É—á—à–∞–µ–º –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –≤ header-right */
            .header-right {
                gap: 6px; /* –£–º–µ–Ω—å—à–∞–µ–º –æ—Ç—Å—Ç—É–ø –Ω–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö */
            }
            
            .header-right .g-btn {
                padding: 6px 12px;
                font-size: 12px;
                height: 34px; /* –ù–µ–º–Ω–æ–≥–æ —É–º–µ–Ω—å—à–∞–µ–º –≤—ã—Å–æ—Ç—É */
            }
            
            .view-btn {
                padding: 6px 12px;
                font-size: 12px;
                height: 34px;
            }
            
            .view-selector {
                height: 34px;
            }
            
            .header-right > .g-btn:last-child {
                height: 34px;
                min-width: 90px;
            }
            
            /* –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ (—Å–ø–∏—Å–æ–∫) */
            .schedule-event {
                padding: 8px;
                flex-direction: column;
                align-items: flex-start;
            }
            
            .event-time-display {
                min-width: auto;
                margin-bottom: 6px;
                font-size: 12px;
            }
            
            .schedule-event .g-btn {
                margin-top: 8px;
                width: 100%;
            }
        }

        /* –î–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ (–¥–æ 360px) */
        @media (max-width: 360px) {
            .calendar-grid {
                min-width: 520px;
            }
            
            .calendar-cell {
                min-width: 74px;
            }
            
            .calendar-event {
                padding: 2px;
                font-size: 8px;
            }
            
            .event-title {
                font-size: 8px;
            }
            
            .logo {
                font-size: 16px;
            }
            
            .current-date {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="calendar-header">
            <div class="header-left">
                <a href="/calendar?user_id={{.UserID}}" class="logo">
                    Spectrum<span>Club</span>
                </a>
                <div class="current-date">{{.CurrentDate.Format "January 2006"}}</div>
            </div>
            <div class="header-right">
                <!-- –£–±—Ä–∞–Ω—ã –∫–Ω–æ–ø–∫–∏ "–°–µ–≥–æ–¥–Ω—è" –∏ "–ú–æ–∏ –∑–∞–ø–∏—Å–∏" -->
                <div class="view-selector">
                    <button class="view-btn {{if eq .View "month"}}active{{end}}" 
                            onclick='window.location="/calendar?user_id={{.UserID}}&view=month&date={{.CurrentDate.Format "2006-01-02"}}"'>
                        –ú–µ—Å—è—Ü
                    </button>
                    <button class="view-btn {{if eq .View "week"}}active{{end}}"
                            onclick='window.location="/calendar?user_id={{.UserID}}&view=week&date={{.CurrentDate.Format "2006-01-02"}}"'>
                        –ù–µ–¥–µ–ª—è
                    </button>
                    <button class="view-btn {{if eq .View "day"}}active{{end}}"
                            onclick='window.location="/calendar?user_id={{.UserID}}&view=day&date={{.CurrentDate.Format "2006-01-02"}}"'>
                        –î–µ–Ω—å
                    </button>
                </div>
                {{if .UserID}}
                <a href="/calendar?user_id={{.UserID}}&view=schedule" class="g-btn">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</a>
                {{end}}
            </div>
        </div>

        <!-- Navigation -->
        <div class="calendar-nav">
            <a href="/calendar?user_id={{.UserID}}&view={{.View}}&date={{.PrevDate.Format "2006-01-02"}}" 
               class="g-btn">‚Äπ</a>
            <span class="nav-date">{{.StartDate.Format "2 January"}} ‚Äì {{.EndDate.Format "2 January 2006"}}</span>
            <a href="/calendar?user_id={{.UserID}}&view={{.View}}&date={{.NextDate.Format "2006-01-02"}}"
               class="g-btn">‚Ä∫</a>
        </div>

        <!-- Main Calendar Content -->
        {{if eq .View "month"}}
        <!-- Month View - –ø–µ—Ä–µ–¥–µ–ª–∞–Ω–æ –¥–ª—è –º–æ–±–∏–ª–æ–∫ -->
        <div class="calendar-grid">
            <!-- Day headers -->
            {{range .WeekDays}}
            <div class="day-header">
                <div class="day-name">{{.Name}}</div>
                <div class="date-num">{{.Day}}</div>
            </div>
            {{end}}

            <!-- Calendar cells -->
            {{range .CalendarDays}}
            <div class="calendar-cell {{if .IsToday}}today{{end}} {{if .IsOtherMonth}}other-month{{end}}"
                 data-date="{{.Date.Format "2006-01-02"}}">
                <div>{{.Date.Day}}</div>
                
                <div class="events-container">
                    {{range $index, $event := .Events}}
                    <div class="calendar-event event-color-{{$event.ColorIndex}} mobile-event" 
                         onclick="showEventDetails('{{$event.ID}}', '{{$event.UserID}}')"
                         title="{{$event.Title}} - {{$event.Time}}">
                        <div class="event-title">{{$event.Title}}</div>
                        <div class="event-time">{{$event.Time}}</div>
                        {{if $event.Coach}}
                        <div class="event-coach">{{$event.Coach}}</div>
                        {{end}}
                    </div>
                    {{end}}
                </div>
            </div>
            {{end}}
        </div>

        {{else if eq .View "week"}}
        <!-- Week View -->
        <div class="week-container">
            <!-- Time column -->
            <div class="time-column">
                {{range .TimeSlots}}
                <div class="time-slot">
                    {{.Format "15:04"}}
                </div>
                {{end}}
            </div>
            
            <!-- Days grid -->
            <div class="week-grid">
                {{range .WeekDays}}
                <div class="calendar-cell {{if .IsToday}}today{{end}}">
                    <div class="day-header">
                        <div class="day-name">{{.Name}}</div>
                        <div class="date-num">{{.Day}}</div>
                    </div>
                    
                    <!-- Events for this day -->
                    {{range .Events}}
                    <div class="calendar-event event-color-{{.ColorIndex}}" 
                         onclick="showEventDetails({{.ID}}, '{{.UserID}}')"
                         title="{{.Title}} - {{.Time}}">
                        <div class="event-title">{{.Title}}</div>
                        <div class="event-time">{{.Time}}</div>
                        {{if .Coach}}
                        <div class="event-coach">{{.Coach}}</div>
                        {{end}}
                    </div>
                    {{end}}
                </div>
                {{end}}
            </div>
        </div>

        {{else if eq .View "day"}}
        <!-- Day View -->
        <div class="day-container">
            <div class="time-column">
                {{range .TimeSlots}}
                <div class="time-slot">
                    {{.Format "15:04"}}
                </div>
                {{end}}
            </div>
            <div class="day-grid">
                {{range .Events}}
                <div class="calendar-event event-color-{{.ColorIndex}}" 
                     onclick="showEventDetails({{.ID}}, '{{.UserID}}')"
                     title="{{.Title}} - {{.Time}}">
                    <div class="event-title">{{.Title}}</div>
                    <div class="event-time">{{.Time}}</div>
                    {{if .Coach}}
                    <div class="event-coach">{{.Coach}}</div>
                    {{end}}
                </div>
                {{end}}
            </div>
        </div>
        {{else}}
        <!-- Schedule View (list) -->
        <div style="margin: 24px;">
            {{range .TrainingDays}}
            <div class="schedule-day">
                <h3 class="day-title">{{.Date}}</h3>
                
                {{range .Trainings}}
                <div class="schedule-event event-color-{{.ColorIndex}}" 
                     onclick="showEventDetails('{{.ID}}', '{{$.UserID}}')">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div class="event-time-display">
                            {{.StartTime}} ‚Äì {{.EndTime}}
                        </div>
                        <div class="event-details">
                            <div class="event-main-title">{{.GroupName}}</div>
                            <div class="event-meta">
                                {{if .CoachName}}üë®‚Äçüè´ {{.CoachName}}{{end}}
                                {{if gt .Participants 0}} ‚Ä¢ üë• {{.Participants}} –∑–∞–ø–∏—Å–∞–ª–∏—Å—å{{end}}
                            </div>
                        </div>
                        {{if not $.IsCoach}}
                        <div>
                            {{if .CanRegister}}
                            <button class="g-btn g-btn-primary" style="padding: 6px 12px;"
                                    onclick="event.stopPropagation(); registerForTraining('{{.ID}}', '{{$.UserID}}')">
                                –ó–∞–ø–∏—Å–∞—Ç—å—Å—è
                            </button>
                            {{else if .IsRegistered}}
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <span style="color: #137333; font-size: 13px; padding: 6px 12px; background: #e6f4ea; border-radius: 4px;">
                                    ‚úÖ –í—ã –∑–∞–ø–∏—Å–∞–Ω—ã
                                </span>
                                <button class="g-btn g-btn-danger-outline" style="padding: 6px 12px;"
                                onclick="event.stopPropagation(); cancelRegistration('{{.ID}}', '{{$.UserID}}')">
                            –û—Ç–º–µ–Ω–∏—Ç—å
                        </button>
                            </div>
                            {{else if .IsFull}}
                            <span style="color: #d93025; font-size: 13px; padding: 6px 12px; background: #fce8e6; border-radius: 4px;">
                                ‚ö†Ô∏è –ú–µ—Å—Ç –Ω–µ—Ç
                            </span>
                            {{end}}
                        </div>
                        {{end}}
                    </div>
                </div>
                {{end}}
            </div>
            {{end}}
        </div>
        {{end}}

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ -->
        <div id="trainingModal" class="modal" style="display: none;">
            <div class="modal-overlay" onclick="closeModal()"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalTitle"></h3>
                    <button class="modal-close" onclick="closeModal()">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="training-details">
                        <div class="detail-row">
                            <span class="detail-label">üìÖ –î–∞—Ç–∞:</span>
                            <span id="modalDate" class="detail-value"></span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">‚è∞ –í—Ä–µ–º—è:</span>
                            <span id="modalTime" class="detail-value"></span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">üë®‚Äçüè´ –¢—Ä–µ–Ω–µ—Ä:</span>
                            <span id="modalCoach" class="detail-value"></span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">üèÉ –£—á–∞—Å—Ç–Ω–∏–∫–æ–≤:</span>
                            <span id="modalParticipants" class="detail-value"></span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">üìù –û–ø–∏—Å–∞–Ω–∏–µ:</span>
                            <span id="modalDescription" class="detail-value"></span>
                        </div>
                        
                        <div id="modalAttendanceSection" style="margin-top: 20px; display: none;">
                            <h4 style="margin-bottom: 10px; color: #3c4043;">–ó–∞–ø–∏—Å–∞–≤—à–∏–µ—Å—è:</h4>
                            <div id="modalAttendanceList" class="attendance-list"></div>
                        </div>
                        
                        <div id="modalActions" class="modal-actions" style="margin-top: 20px;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Position events in week and day views
        function positionEvents() {
            document.querySelectorAll('.week-grid .calendar-event, .day-grid .calendar-event').forEach(event => {
                const timeText = event.querySelector('.event-time')?.textContent;
                if (!timeText) return;
                
                const [startTime, endTime] = timeText.split(' - ');
                if (!startTime || !endTime) return;
                
                const startMinutes = timeToMinutes(startTime.trim());
                const endMinutes = timeToMinutes(endTime.trim());
                
                // Starting from 8:00 AM (480 minutes)
                const startHour = 8;
                const pixelsPerHour = 60;
                
                const top = (startMinutes - (startHour * 60)) * (pixelsPerHour / 60);
                const height = (endMinutes - startMinutes) * (pixelsPerHour / 60);
                
                event.style.top = `${top}px`;
                event.style.height = `${height}px`;
            });
        }
    
        function timeToMinutes(time) {
            const [hours, minutes] = time.split(':').map(Number);
            return hours * 60 + (minutes || 0);
        }
    
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
        function showEventDetails(trainingId, userId) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            document.getElementById('modalTitle').textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
            document.getElementById('modalActions').innerHTML = '';
            
            // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–µ—Ç–∞–ª–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
            fetch(`/api/training/${trainingId}?user_id=${userId}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
                    }
                    return response.json();
                })
                .then(data => {
                    updateModalContent(data, trainingId, userId);
                    showModal();
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞:', error);
                    alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–µ—Ç–∞–ª–µ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏');
                });
        }
    
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function updateModalContent(data, trainingId, userId) {
            // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
            document.getElementById('modalTitle').textContent = data.training.group_name;
            document.getElementById('modalDate').textContent = formatDate(data.training.training_date);
            document.getElementById('modalTime').textContent = `${data.training.start_time} - ${data.training.end_time}`;
            document.getElementById('modalCoach').textContent = data.training.coach_name || '–ù–µ —É–∫–∞–∑–∞–Ω';
            document.getElementById('modalParticipants').textContent = `${data.participants_count}${data.training.max_participants ? ` / ${data.training.max_participants}` : ''}`;
            document.getElementById('modalDescription').textContent = data.training.description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç';
            
            // –°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
            const attendanceSection = document.getElementById('modalAttendanceSection');
            const attendanceList = document.getElementById('modalAttendanceList');
            
            if (data.participants && data.participants.length > 0) {
                attendanceSection.style.display = 'block';
                attendanceList.innerHTML = '';
                
                data.participants.forEach(participant => {
                    const item = document.createElement('div');
                    item.className = 'attendance-item';
                    
                    const firstLetter = participant.student_name ? participant.student_name.charAt(0).toUpperCase() : '?';
                    
                    item.innerHTML = `
                        <div class="attendance-avatar">${firstLetter}</div>
                        <div>
                            <div class="attendance-name">${participant.student_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π'}</div>
                            <div class="attendance-time">–ó–∞–ø–∏—Å–∞–Ω: ${formatDateTime(participant.created_at)}</div>
                        </div>
                    `;
                    
                    attendanceList.appendChild(item);
                });
            } else {
                attendanceSection.style.display = 'none';
            }
            
            // –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
            const actionsDiv = document.getElementById('modalActions');
            actionsDiv.innerHTML = '';
            
            if (data.is_registered) {
                // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∑–∞–ø–∏—Å–∞–Ω
                actionsDiv.innerHTML = `
                    <button class="modal-btn modal-btn-secondary" onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
                    <button class="modal-btn modal-btn-danger" onclick="cancelRegistration(${trainingId}, '${userId}')">–û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
                `;
            } else if (data.can_register) {
                // –ú–æ–∂–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è
                actionsDiv.innerHTML = `
                    <button class="modal-btn modal-btn-secondary" onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
                    <button class="modal-btn modal-btn-primary" onclick="registerForTraining(${trainingId}, '${userId}')">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è</button>
                `;
            } else {
                // –ù–µ–ª—å–∑—è –∑–∞–ø–∏—Å–∞—Ç—å—Å—è
                let reason = '';
                if (data.is_full) reason = ' (–ú–µ—Å—Ç –Ω–µ—Ç)';
                else if (data.is_past) reason = ' (–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ—à–ª–∞)';
                
                actionsDiv.innerHTML = `
                    <button class="modal-btn modal-btn-secondary" onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
                    <span style="color: #5f6368; padding: 10px;">–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è${reason}</span>
                `;
            }
        }
    
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        function showModal() {
            document.getElementById('trainingModal').style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
    
        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        function closeModal() {
            document.getElementById('trainingModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }
    
        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã
        function formatDate(dateString) {
            const date = new Date(dateString);
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('ru-RU', options);
        }
    
        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏
        function formatDateTime(dateTimeString) {
            if (!dateTimeString) return '';
            const date = new Date(dateTimeString);
            return date.toLocaleDateString('ru-RU') + ' ' + date.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
        }
    
        // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø–∏—Å–∏ –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
        function registerForTraining(trainingId, userId) {
            if (!confirm('–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —ç—Ç—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É?')) return;
            
            const formData = new FormData();
            formData.append('training_id', trainingId);
            formData.append('user_id', userId);
            
            fetch('/register', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (response.ok) {
                    alert('‚úÖ –í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–ø–∏—Å–∞–ª–∏—Å—å –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É!');
                    closeModal();
                    location.reload();
                } else {
                    return response.text().then(text => {
                        throw new Error(text || '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
                    });
                }
            })
            .catch(error => {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
            });
        }
    
        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–º–µ–Ω—ã –∑–∞–ø–∏—Å–∏
        function cancelRegistration(trainingId, userId) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å?')) return;
            
            const formData = new FormData();
            formData.append('training_id', trainingId);
            formData.append('user_id', userId);
            
            fetch('/cancel', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (response.ok) {
                    alert('‚úÖ –ó–∞–ø–∏—Å—å –æ—Ç–º–µ–Ω–µ–Ω–∞');
                    closeModal();
                    location.reload();
                } else {
                    return response.text().then(text => {
                        throw new Error(text || '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
                    });
                }
            })
            .catch(error => {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
            });
        }
    
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal-overlay')) {
                closeModal();
            }
        });
    
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
        });
    
        // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        function adaptForMobile() {
            const isMobile = window.innerWidth <= 768;
            
            if (isMobile) {
                // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –¥–ª—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è
                const calendarGrid = document.querySelector('.calendar-grid');
                if (calendarGrid && calendarGrid.scrollWidth > calendarGrid.clientWidth) {
                    calendarGrid.style.position = 'relative';
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
                    if (!document.getElementById('scroll-hint')) {
                        const hint = document.createElement('div');
                        hint.id = 'scroll-hint';
                        hint.innerHTML = '‚Üê –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ ‚Üí';
                        hint.style.cssText = `
                            position: absolute;
                            bottom: 5px;
                            right: 5px;
                            background: rgba(0,0,0,0.7);
                            color: white;
                            padding: 4px 8px;
                            border-radius: 12px;
                            font-size: 11px;
                            z-index: 10;
                            animation: pulse 2s infinite;
                        `;
                        
                        const style = document.createElement('style');
                        style.textContent = `
                            @keyframes pulse {
                                0% { opacity: 0.7; }
                                50% { opacity: 1; }
                                100% { opacity: 0.7; }
                            }
                        `;
                        document.head.appendChild(style);
                        
                        calendarGrid.appendChild(hint);
                        
                        // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –ø–æ—Å–ª–µ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
                        calendarGrid.addEventListener('scroll', function() {
                            hint.style.opacity = '0';
                            setTimeout(() => hint.remove(), 300);
                        }, { once: true });
                    }
                }
                
                // –£–ª—É—á—à–∞–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
                document.querySelectorAll('.calendar-cell .events-container').forEach(container => {
                    if (container.scrollHeight > container.clientHeight) {
                        // –î–æ–±–∞–≤–ª—è–µ–º –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è
                        container.style.position = 'relative';
                        container.style.maskImage = 'linear-gradient(to bottom, black 80%, transparent 100%)';
                        container.style.webkitMaskImage = 'linear-gradient(to bottom, black 80%, transparent 100%)';
                    }
                });
            }
        }
    
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            positionEvents();
            adaptForMobile();
            
            // –£–ë–†–ê–ù –ö–û–î –î–õ–Ø –°–í–ê–ô–ü–ê - –±–æ–ª—å—à–µ –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º –º–µ—Å—è—Ü—ã –ø—Ä–∏ —Å–≤–∞–π–ø–µ
        });
    
        window.addEventListener('resize', function() {
            positionEvents();
            adaptForMobile();
        });
    </script>
</body>
</html>