<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Training.GroupName}}</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f7fa; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .card { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); margin-bottom: 20px; }
        .btn { padding: 12px 24px; background: #3498db; color: white; border: none; border-radius: 8px; text-decoration: none; display: inline-block; font-weight: 500; cursor: pointer; }
        .btn:hover { background: #2980b9; }
        .btn-success { background: #27ae60; }
        .btn-success:hover { background: #229954; }
        .btn-danger { background: #e74c3c; }
        .btn-danger:hover { background: #c0392b; }
        .participant { padding: 12px; border-bottom: 1px solid #ecf0f1; display: flex; align-items: center; gap: 12px; }
        .training-meta { display: flex; flex-wrap: wrap; gap: 20px; margin: 20px 0; }
        .meta-item { background: #f8f9fa; padding: 12px 20px; border-radius: 8px; min-width: 200px; }
        .meta-label { color: #7f8c8d; font-size: 14px; margin-bottom: 5px; }
        .meta-value { font-size: 16px; font-weight: 500; color: #2c3e50; }
    </style>
</head>
<body>
    <div class="container">
        <div style="margin-bottom: 20px;">
            <a href="/schedule?user_id={{.UserID}}" class="btn">‚Üê –ù–∞–∑–∞–¥ –∫ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é</a>
        </div>
        
        <div class="card">
            <h1 style="color: #2c3e50; margin-bottom: 10px;">{{.Training.GroupName}}</h1>
            
            <div class="training-meta">
                <div class="meta-item">
                    <div class="meta-label">üìÖ –î–∞—Ç–∞</div>
                    <div class="meta-value">{{.Training.TrainingDate.Format "Monday, 02 January 2006"}}</div>
                </div>
                <div class="meta-item">
                    <div class="meta-label">‚è∞ –í—Ä–µ–º—è</div>
                    <div class="meta-value">{{.Training.StartTime.Format "15:04"}} - {{.Training.EndTime.Format "15:04"}}</div>
                </div>
                <div class="meta-item">
                    <div class="meta-label">üë®‚Äçüè´ –¢—Ä–µ–Ω–µ—Ä</div>
                    <div class="meta-value">{{.Training.CoachName}}</div>
                </div>
                <div class="meta-item">
                    <div class="meta-label">üèÉ –ú–µ—Å—Ç–∞</div>
                    <div class="meta-value">
                        {{if .Training.MaxParticipants}}
                            {{sub .Training.MaxParticipants (len .Participants)}} –∏–∑ {{.Training.MaxParticipants}}
                        {{else}}
                            –ù–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ
                        {{end}}
                    </div>
                </div>
            </div>
            
            {{if .Training.Description}}
            <div style="margin: 25px 0; padding: 20px; background: #f8f9fa; border-radius: 8px; line-height: 1.6;">
                {{.Training.Description}}
            </div>
            {{end}}
            
            <!-- Student Actions -->
            {{if and .UserID (not .IsCoach)}}
                {{if .Attendance}}
                    {{if eq .Attendance.Status "registered"}}
                    <div style="padding: 20px; background: #d4edda; border-radius: 8px; margin: 20px 0;">
                        ‚úÖ –í—ã –∑–∞–ø–∏—Å–∞–Ω—ã –Ω–∞ —ç—Ç—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
                    </div>
                    <form method="POST" action="/cancel" onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å?');">
                        <input type="hidden" name="training_id" value="{{.Training.ID}}">
                        <input type="hidden" name="user_id" value="{{.UserID}}">
                        <button type="submit" class="btn btn-danger">–û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
                    </form>
                    {{end}}
                {{else}}
                    {{if .CanRegister}}
                    <form method="POST" action="/register">
                        <input type="hidden" name="training_id" value="{{.Training.ID}}">
                        <input type="hidden" name="user_id" value="{{.UserID}}">
                        <button type="submit" class="btn btn-success" style="padding: 15px 30px; font-size: 16px;">
                            üìù –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
                        </button>
                    </form>
                    {{else}}
                        {{if .IsFull}}
                        <div style="padding: 20px; background: #fff3cd; border-radius: 8px; margin: 20px 0;">
                            ‚ö†Ô∏è –í—Å–µ –º–µ—Å—Ç–∞ –∑–∞–Ω—è—Ç—ã
                        </div>
                        {{else if .Training.TrainingDate.Before .CurrentTime}}
                        <div style="padding: 20px; background: #f8d7da; border-radius: 8px; margin: 20px 0;">
                            ‚è∞ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —É–∂–µ –ø—Ä–æ—à–ª–∞
                        </div>
                        {{end}}
                    {{end}}
                {{end}}
            {{end}}
            
            <!-- Coach View -->
            {{if and .UserID .IsCoach}}
                {{if .Participants}}
                <div style="margin-top: 30px;">
                    <h3 style="margin-bottom: 15px; color: #2c3e50;">–£—á–∞—Å—Ç–Ω–∏–∫–∏ ({{len .Participants}})</h3>
                    <div style="background: white; border-radius: 8px; overflow: hidden;">
                        {{range .Participants}}
                        <div class="participant">
                            <div style="width: 40px; height: 40px; background: #3498db; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                                {{if .StudentName}}{{slice .StudentName 0 1}}{{else}}U{{end}}
                            </div>
                            <div>
                                <strong>{{.StudentName}}</strong>
                                <div style="color: #95a5a6; font-size: 14px; margin-top: 2px;">
                                    –ó–∞–ø–∏—Å–∞–Ω {{.CreatedAt.Format "02.01 –≤ 15:04"}}
                                </div>
                            </div>
                        </div>
                        {{end}}
                    </div>
                </div>
                {{else}}
                <div style="padding: 30px; text-align: center; color: #95a5a6;">
                    üë• –ü–æ–∫–∞ –Ω–∏–∫—Ç–æ –Ω–µ –∑–∞–ø–∏—Å–∞–ª—Å—è
                </div>
                {{end}}
            {{end}}
        </div>
    </div>
</body>
</html>