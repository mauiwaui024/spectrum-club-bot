<div class="container">
  <!-- Header -->
  <div class="calendar-header">
    <div class="header-left">
      <a [routerLink]="['/calendar']" [queryParams]="{user_id: route.snapshot.queryParams['user_id']}" class="logo">
        Spectrum<span>Club</span>
      </a>
    </div>
    <div class="header-right">
      <div class="view-selector">
        <button 
          class="view-btn" 
          [class.active]="view === CalendarView.Month"
          (click)="changeView(CalendarView.Month)">–ú–µ—Å—è—Ü</button>
        <button 
          class="view-btn" 
          [class.active]="view === CalendarView.Week"
          (click)="changeView(CalendarView.Week)">–ù–µ–¥–µ–ª—è</button>
        <button 
          class="view-btn" 
          [class.active]="view === CalendarView.Day"
          (click)="changeView(CalendarView.Day)">–î–µ–Ω—å</button>
      </div>
    </div>
  </div>

  <!-- Navigation -->
  <div class="calendar-nav">
    <button 
      class="g-btn" 
      mwlCalendarPreviousView
      [view]="view"
      [(viewDate)]="viewDate"
      (viewDateChange)="onViewDateChange($event)">‚Äπ</button>
    <span class="nav-date">{{ calendarData ? getDateRange() : '–ó–∞–≥—Ä—É–∑–∫–∞...' }}</span>
    <button 
      class="g-btn"
      mwlCalendarNextView
      [view]="view"
      [(viewDate)]="viewDate"
      (viewDateChange)="onViewDateChange($event)">‚Ä∫</button>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

  <!-- Error -->
  <div *ngIf="error" class="error">{{ error }}</div>

  <!-- Calendar -->
  <div *ngIf="!loading && !error" style="padding: 20px;">
    <mwl-calendar-month-view
      *ngIf="view === CalendarView.Month"
      [viewDate]="viewDate"
      [events]="events"
      (eventClicked)="onEventClicked($event.event)">
    </mwl-calendar-month-view>
    <mwl-calendar-week-view
      *ngIf="view === CalendarView.Week"
      [viewDate]="viewDate"
      [events]="events"
      (eventClicked)="onEventClicked($event.event)">
    </mwl-calendar-week-view>
    <mwl-calendar-day-view
      *ngIf="view === CalendarView.Day"
      [viewDate]="viewDate"
      [events]="events"
      (eventClicked)="onEventClicked($event.event)">
    </mwl-calendar-day-view>
  </div>

  <!-- Modal for Training Details -->
  <div *ngIf="showModal" class="modal" (click)="closeModal()">
    <div class="modal-overlay" (click)="closeModal()"></div>
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3 id="modalTitle">
          <span *ngIf="loadingTraining">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
          <span *ngIf="!loadingTraining && selectedTraining">{{ selectedTraining.training.group_name }}</span>
        </h3>
        <button class="modal-close" (click)="closeModal()">√ó</button>
      </div>
      <div class="modal-body" *ngIf="selectedTraining && !loadingTraining">
        <div class="training-details">
          <div class="detail-row">
            <span class="detail-label">üìÖ –î–∞—Ç–∞:</span>
            <span class="detail-value">{{ formatDate(selectedTraining.training.training_date) }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">‚è∞ –í—Ä–µ–º—è:</span>
            <span class="detail-value">{{ selectedTraining.training.start_time }} - {{ selectedTraining.training.end_time }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">üë®‚Äçüè´ –¢—Ä–µ–Ω–µ—Ä:</span>
            <span class="detail-value">{{ selectedTraining.training.coach_name || '–ù–µ —É–∫–∞–∑–∞–Ω' }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">üèÉ –£—á–∞—Å—Ç–Ω–∏–∫–æ–≤:</span>
            <span class="detail-value">
              {{ selectedTraining.participants_count }}
              <span *ngIf="selectedTraining.training.max_participants">
                / {{ selectedTraining.training.max_participants }}
              </span>
            </span>
          </div>
          <div class="detail-row">
            <span class="detail-label">üìù –û–ø–∏—Å–∞–Ω–∏–µ:</span>
            <span class="detail-value">{{ selectedTraining.training.description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç' }}</span>
          </div>
          
          <div *ngIf="selectedTraining.participants && selectedTraining.participants.length > 0" 
               id="modalAttendanceSection" style="margin-top: 20px;">
            <h4 style="margin-bottom: 10px; color: #3c4043;">–ó–∞–ø–∏—Å–∞–≤—à–∏–µ—Å—è:</h4>
            <div class="attendance-list">
              <div *ngFor="let participant of selectedTraining.participants" class="attendance-item">
                <div class="attendance-avatar">
                  {{ participant.student_name ? participant.student_name.charAt(0).toUpperCase() : '?' }}
                </div>
                <div>
                  <div class="attendance-name">{{ participant.student_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π' }}</div>
                  <div class="attendance-time">–ó–∞–ø–∏—Å–∞–Ω: {{ formatDateTime(participant.created_at) }}</div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="modal-actions" style="margin-top: 20px;">
            <button 
              *ngIf="selectedTraining.is_registered"
              class="modal-btn modal-btn-secondary" 
              (click)="closeModal()">
              –ó–∞–∫—Ä—ã—Ç—å
            </button>
            <button 
              *ngIf="selectedTraining.is_registered"
              class="modal-btn modal-btn-danger" 
              (click)="cancelRegistration()">
              –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å
            </button>
            <button 
              *ngIf="selectedTraining.can_register"
              class="modal-btn modal-btn-secondary" 
              (click)="closeModal()">
              –ó–∞–∫—Ä—ã—Ç—å
            </button>
            <button 
              *ngIf="selectedTraining.can_register"
              class="modal-btn modal-btn-primary" 
              (click)="registerForTraining()">
              –ó–∞–ø–∏—Å–∞—Ç—å—Å—è
            </button>
            <div *ngIf="!selectedTraining.can_register && !selectedTraining.is_registered">
              <button class="modal-btn modal-btn-secondary" (click)="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
              <span style="color: #5f6368; padding: 10px;">
                –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è
                <span *ngIf="selectedTraining.is_full"> (–ú–µ—Å—Ç –Ω–µ—Ç)</span>
                <span *ngIf="selectedTraining.is_past"> (–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ—à–ª–∞)</span>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
